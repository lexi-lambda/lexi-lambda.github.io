<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Deploying Racket applications on Heroku</title><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,300,300italic,400italic,700,700italic,800,800italic|Merriweather:400,300,300italic,400italic,700,700italic,900,900italic|Fira+Code:300,400,500,600,700"/><link rel="stylesheet" type="text/css" href="/css/application.min.css"/><link rel="stylesheet" type="text/css" href="/css/pygments.min.css"/><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feeds/all.atom.xml"/><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feeds/all.rss.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-65250372-1"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);};gtag('js', new Date());gtag('config', 'UA-65250372-1');</script><body><header><nav role="navigation" class="navigation-bar"><ul class="navigation-items left"><li class="blog-title-header"><a href="/">Alexis King</a></li></ul><ul class="navigation-items center"></ul><ul class="navigation-items right"><li><a href="/">Home</a></li><li><a href="/about.html">About Me</a></li></ul></nav></header><section role="main"><div class="content"><article class="main"><header><h1 class="title">Deploying Racket applications on Heroku</h1><div class="date-and-tags"><time datetime="2015-08-22">2015-08-22</time> <span style="margin: 0 5px">⦿</span> <a href="/tags/racket.html">racket</a>, <a href="/tags/heroku.html">heroku</a>, <a href="/tags/12factor.html">12factor</a></div></header><p><a href="https://www.heroku.com">Heroku</a> is a "platform as a service" that provides an incredibly simple way to deploy simple internet applications, and I take liberal advantage of its free tier for testing out simple applications. It has support for a variety of languages built-in, but Racket is not currently among them. Fortunately, Heroku provides an interface for adding custom build processes for arbitrary types of applications, called “buildpacks”. I've built one for Racket apps, and with just a little bit of configuration, it’s possible to get a Racket webserver running on Heroku.</p><h2><a name="building-the-server"></a>Building the server</h2><p>Racket's <a href="http://docs.racket-lang.org/web-server/index.html">web-server</a> package makes building and running a simple server incredibly easy. Here's all the code we'll need to get going:</p><pre><code class="pygments"><span class="kn">#lang </span><span class="nn">racket</span>

<span class="p">(</span><span class="k">require</span> <span class="n">web-server/servlet</span>
         <span class="n">web-server/servlet-env</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="n">start</span> <span class="n">req</span><span class="p">)</span>
  <span class="p">(</span><span class="n">response/xexpr</span>
   <span class="o">&#39;</span><span class="p">(</span><span class="ss">html</span> <span class="p">(</span><span class="ss">head</span> <span class="p">(</span><span class="ss">title</span> <span class="s2">"Racket Heroku App"</span><span class="p">))</span>
          <span class="p">(</span><span class="ss">body</span> <span class="p">(</span><span class="ss">h1</span> <span class="s2">"It works!"</span><span class="p">)))))</span>

<span class="p">(</span><span class="n">serve/servlet</span> <span class="n">start</span> <span class="kd">#:servlet-path</span> <span class="s2">"/"</span><span class="p">)</span></code></pre><p>Running the above file will start up the server on the default port, 8080. When running on Heroku, however, we're required to bind to the port that Heroku provides via the <code>PORT</code> environment variable. We can access this using the Racket <code>getenv</code>[racket] function.</p><p>Additionally, the Racket web server specifically binds to localhost, but Heroku doesn't allow that restriction, so we need to pass <code>#f</code> for the <code>#:listen-ip</code> argument.</p><pre><code class="pygments"><span class="p">(</span><span class="k">define</span> <span class="n">port</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">getenv</span> <span class="s2">"PORT"</span><span class="p">)</span>
                 <span class="p">(</span><span class="nb">string-&gt;number</span> <span class="p">(</span><span class="nb">getenv</span> <span class="s2">"PORT"</span><span class="p">))</span>
                 <span class="mi">8080</span><span class="p">))</span>
<span class="p">(</span><span class="n">serve/servlet</span> <span class="n">start</span>
               <span class="kd">#:servlet-path</span> <span class="s2">"/"</span>
               <span class="kd">#:listen-ip</span> <span class="no">#f</span>
               <span class="kd">#:port</span> <span class="n">port</span><span class="p">)</span></code></pre><p>Also, by default, <code>serve/servlet</code>[racket] will open a web browser automatically when the program is run, which is very useful for rapid prototyping within something like DrRacket, but we'll want to turn that off.</p><pre><code class="pygments"><span class="p">(</span><span class="n">serve/servlet</span> <span class="n">start</span>
               <span class="kd">#:servlet-path</span> <span class="s2">"/"</span>
               <span class="kd">#:listen-ip</span> <span class="no">#f</span>
               <span class="kd">#:port</span> <span class="n">port</span>
               <span class="kd">#:command-line?</span> <span class="no">#t</span><span class="p">)</span></code></pre><p>That's it! Now we have a Racket web server that can run on Heroku. Obviously it's not a very interesting application right now, but that's fine for our purposes.</p><h2><a name="setting-up-our-app-for-heroku"></a>Setting up our app for Heroku</h2><p>The next step is to actually create an app on Heroku. Don't worry—it's free! That said, explaining precisely how Heroku works is outside the scope of this article. Just make an account, then create an app. I called mine "racket-heroku-sample". Once you've created an app and set up Heroku's command-line tool, you can specify the proper buildpack:</p><pre><code class="pygments">$ git init
$ heroku git:remote -a racket-heroku-sample
$ heroku buildpacks:set https://github.com/lexi-lambda/heroku-buildpack-racket</code></pre><p>We'll also need to pick a particular Racket version before we deploy our app. At the time of this writing, Racket 6.2.1 is the latest version, so I just set the <code>RACKET_VERSION</code> environment variable as follows:</p><pre><code class="pygments">$ heroku config:set <span class="nv">RACKET_VERSION</span><span class="o">=</span><span class="m">6</span>.2.1</code></pre><p>Now there's just one thing left to do before we can push to Heroku: we need to tell Heroku what command to use to run our application. To do this, we use something called a "Procfile" that contains information about the process types for our app. Heroku supports multiple processes of different types, but we're just going to have a single web process.</p><p>Specifically, we just want to run our <code>serve.rkt</code> module. The Racket buildpack installs the repository as a package, so we can run <code>racket</code> with the <code>-l</code> flag to specify a module path, which will be more robust than specifying a filesystem path directly. Therefore, our Procfile will look like this:</p><pre><code>web: racket -l sample-heroku-app/server
</code></pre><p>Now all that's left to do is push our repository to Heroku's git remote. Once the build completes, we can <a href="https://racket-heroku-sample.herokuapp.com">navigate to our app's URL and actually see it running live</a>!</p><h2><a name="conclusion"></a>Conclusion</h2><p>That's all that's needed to get a Racket app up and running on Heroku, but it probably isn't the best way to manage a real application. Usually it's best to use a continuous integration service to automatically deploy certain GitHub branches to Heroku, after running the tests, of course. Also, a real application would obviously be a little more complicated.</p><p>That said, this provides the foundation and shell. If you'd like to see the sample app used in this post, you can <a href="https://github.com/lexi-lambda/racket-sample-heroku-app">find it on GitHub here</a>. For more details on the buildpack itself, <a href="https://github.com/lexi-lambda/heroku-buildpack-racket">it's also available on GitHub here</a>.</p><ol class="footnotes"></ol><ul class="post-navigation"><li class="previous"><a href="/blog/2015/08/30/managing-application-configuration-with-envy/">←&nbsp;<span class="post-title">Managing application configuration with Envy</span></a></li><li class="next"><a href="/blog/2015/07/18/automatically-deploying-a-frog-powered-blog-to-github-pages/"><span class="post-title">Automatically deploying a Frog-powered blog to GitHub pages</span>&nbsp;→</a></li></ul></article></div></section><footer><div class="copyright-notice">© 2022, Alexis King</div><div>Built with <a href="https://docs.racket-lang.org/scribble/index.html"><strong>Scribble</strong></a>, the Racket document preparation system.</div><div>Feeds are available via <a href="/feeds/all.atom.xml">Atom</a> or <a href="/feeds/all.rss.xml">RSS</a>.</div></footer></body></head></html>